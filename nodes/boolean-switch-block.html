<!-- UI Template Section -->
<script type="text/html" data-template-name="boolean-switch-block">
    <div class="form-row">
        <label for="node-input-name" title="Display name shown on the canvas"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label><i class="fa fa-toggle-on"></i> Toggle</label>
        <button id="node-toggle-button" class="red-ui-button">Toggle</button>
    </div>
</script>

<!-- JavaScript Section -->
<script type="text/javascript">
    RED.nodes.registerType("boolean-switch-block", {
        category: "control",
        color: "#301934",
        defaults: {
            name: { value: "boolean switch" }
        },
        inputs: 1,
        outputs: 1,
        inputLabels: ["control"],
        outputLabels: ["slot value"],
        icon: "font-awesome/fa-wrench",
        paletteLabel: "boolean switch",
        label: function() {
            return this.name ? `${this.name} (2)` : `boolean switch (2)`;
        },
        oneditprepare: function() {
            const id = this.id;
            // Initialize with pending client-side values
            $("#node-input-name").val(this.name || "boolean switch");

            // Fetch server data only for deployed nodes
            $.getJSON(`/boolean-switch-block/${id}?t=${Date.now()}`, function(data) {
                // Only update if node is deployed and data differs
                if (data && data.name !== this.name) {
                    $("#node-input-name").val(data.name || this.name || "boolean switch");
                }
            }.bind(this)).fail(function() {
                // No server data; rely on this properties (already set)
            });

            $("#node-toggle-button").click(function() {
                $.ajax({
                    url: `/boolean-switch-block/${id}/toggle`,
                    type: "POST",
                    success: function() {
                        console.log(`Toggled boolean switch node ${id} via editor`);
                    },
                    error: function() {
                        console.error(`Failed to toggle boolean switch node ${id}`);
                    }
                });
            });
        },
        oneditsave: function() {
            // Standard config properties are automatically saved by Node-RED
        }
    });
</script>

<!-- Help Section -->
<script type="text/markdown" data-help-name="boolean-switch-block">
Toggles a boolean state and outputs values from context slots based on the state.

### Inputs
- **context** <span class="property-type">string</span>
  Sets slot values (`inTrue` or `inFalse`).
- **payload** <span class="property-type">any</span>
  Controls the switch (`"toggle"`, `true`, `"true"`, `false`, `"false"`) or sets slot values.

### Outputs
- **payload** <span class="property-type">any</span>
  Value of `inTrue` when state is `true`, or `inFalse` when state is `false`.

### Details
The Boolean Switch Block maintains a boolean state (`true` or `false`) and two slots (`inTrue` and `inFalse`) that can hold any value. It outputs the value of `inTrue` when the state is `true`, or `inFalse` when the state is `false`. Outputs occur when the state changes (via `"toggle"`, `true`, `false`, or manual toggle) or the active slot is updated.

The state can be set via `msg.payload` (`"toggle"`, `true`, `"true"`, `false`, `"false"`) or a toggle button in the editor. Slot values are updated via `msg.context = "inTrue"` or `"inFalse"`. Toggle count is tracked in context for persistence.

### Examples
- **Toggle State**: Input `{ payload: "toggle" }` with state `false`, output `{ payload: null }` (if `inTrue = null`).
- **Set True**: Input `{ payload: true }`, output `{ payload: null }` (if `inTrue = null`).
- **Update Slot**: Input `{ context: "inTrue", payload: 42 }` with state `true`, output `{ payload: 42 }`.

### Error Handling
- Missing `msg.payload` for slot update: Shows "missing payload for X" (yellow), no output.
- Invalid `msg.payload` for state: Shows "invalid input" (yellow), no output.
- Unknown `msg.context`: Shows "unknown context" (yellow), no output.

Status shows green for `true` (e.g., `state: true, out: 42`), red for `false` (e.g., `state: false, out: null`), yellow for errors.

### References
- [Node-RED Documentation](https://nodered.org/docs/) - official Node-RED documentation
- [GitHub Repository](https://github.com/your-repo/node-red-contrib-buildingblocks-control) - source code and additional help
</script>