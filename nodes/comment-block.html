<script type="text/html" data-template-name="comment-block">
    <div class="form-row">
        <label for="node-input-name" title="Display name shown on the canvas"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-comment" title="Comment shown in status when Default is selected (max 100 characters)"><i class="fa fa-comment"></i> Comment</label>
        <input type="text" id="node-input-comment" placeholder="Enter comment (max 100 chars)" maxlength="100">
    </div>
    <div class="form-row">
        <label for="node-input-statusDisplay" title="Select what to display in the node status"><i class="fa fa-eye"></i> Status Display</label>
        <select id="node-input-statusDisplay">
            <option value="default">Comment to status (Default)</option>
            <option value="name">Name to status</option>
            <option value="none">No status</option>
        </select>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("comment-block", {
        category: "control",
        color: "#301934",
        defaults: {
            name: { value: "comment" },
            comment: { value: "No comment" },
            statusDisplay: { value: "default" }
        },
        inputs: 1,
        outputs: 1,
        inputLabels: ["input"],
        outputLabels: ["output"],
        icon: "font-awesome/fa-comment",
        paletteLabel: "comment",
        label: function() {
            return this.name || this.comment || "comment";
        },
        oneditprepare: function() {
            // Initialize inputs
            $("#node-input-name").val(this.name || "comment");
            $("#node-input-comment").val(this.comment || "No comment");
            $("#node-input-statusDisplay").val(this.statusDisplay || "default");

            // Validate comment input
            $("#node-input-comment").on("input", function() {
                const val = $(this).val();
                if (!val || val.trim().length === 0 || val.length > 100) {
                    $(this).addClass("input-error");
                } else {
                    $(this).removeClass("input-error");
                }
            });
        },
        oneditsave: function() {
            // Update status immediately
            const node = RED.nodes.getNode(this.id);
            if (node) {
                let status = {};
                if (node.statusDisplay === "default") {
                    status = { fill: "green", shape: "dot", text: node.comment || "No comment set" };
                } else if (node.statusDisplay === "name") {
                    status = { fill: "green", shape: "dot", text: node.name || "comment" };
                } // "none" leaves status empty
                node.status(status);
            }
        },
        oneditvalidate: function() {
            const comment = $("#node-input-comment").val();
            if (!comment || comment.trim().length === 0 || comment.length > 100) {
                $("#node-input-comment").addClass("input-error");
                return false;
            }
            return true;
        }
    });
</script>

<script type="text/markdown" data-help-name="comment-block">
Displays a configurable comment, node name, or no status persistently and on input.

### Inputs
: payload (any) : Any input message triggers status display (optional).

### Outputs
: payload (any) : Input message, passed unchanged.
: *other* (any) : Other message properties, passed unchanged.

### Details
Displays a status (comment, node name, or none) on node creation, editor saves, and input messages. Configurable via editor:
- `name`: Sets canvas display name and status text if `statusDisplay` is `name`.
- `comment`: Sets status text (max 100 characters) if `statusDisplay` is `default`.
- `statusDisplay`:
  - `default`: Shows `comment` or "No comment set" if empty.
  - `name`: Shows `name` or "comment" if empty.
  - `none`: No status.
Used for flow annotations or debugging without requiring input to trigger status.

### Error Handling
- Invalid message (e.g., `msg` undefined): No output, red status (`invalid message`).
- Empty `comment` with `default`: Shows `No comment set`.
- Empty `name` with `name`: Shows `comment`.
- Long `comment` (> 100 chars): Truncated.

### Status
- Green (dot): Configuration updates (e.g., `Sensor check`, `Fan Note`).
- Blue (dot): Input-triggered status when text changes (e.g., `Sensor check`).
- Blue (ring): Input-triggered status when text unchanged (e.g., `Sensor check`).
- Red (ring): Errors (e.g., `invalid message`).

### References
- [Node-RED Documentation](https://nodered.org/docs/)
- [GitHub Repository](https://github.com/your-repo/node-red-contrib-buildingblocks-control)
</script>