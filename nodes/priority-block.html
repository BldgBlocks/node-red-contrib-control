<!-- UI Template Section: Defines the edit dialog -->
<script type="text/html" data-template-name="priority-block">
    <div class="form-row">
        <label for="node-input-name" title="Display name shown on the canvas"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<!-- JavaScript Section: Registers the node and handles editor logic -->
<script type="text/javascript">
    RED.nodes.registerType("priority-block", {
        category: "control",
        color: "#301934",
        defaults: {
            name: { value: "" }
        },
        inputs: 1,
        outputs: 1,
        inputLabels: ["input"],
        outputLabels: ["output"],
        icon: "font-awesome/fa-list-ol",
        paletteLabel: "priority",
        label: function() {
            return this.name || "priority";
        }
    });
</script>

<!-- Help Section -->
<script type="text/markdown" data-help-name="priority-block">
Implements a priority array with 16 levels, default, and fallback.

### Inputs
: context (string) : Identifies slot (`"priority1"` to `"priority16"`, `"default"`, `"fallback"`) for setting or clearing. Ignored if `msg.payload` is an object with `clear` key.
: payload (any | object | string) : 
  - Non-object, non-"clear" (number, boolean, null) Value for slot specified by `msg.context` (numbers parsed as float, null to relinquish).
  - String `"clear"` Relinquish slot specified by `msg.context`.
  - Object with `clear`
    - `{ clear "priorityX" }` Relinquish single slot.
    - `{ clear ["priorityX", ...] }` Relinquish multiple slots.
    - `{ clear "all" }` Relinquish all slots.

### Outputs
: payload (any) : Value from highest non-null slot (`priority1` to `fallback`), or `null` if none set.
: diagnostics.activePriority (string) : Active slot (`"priority1"` to `"priority16"`, `"default"`, `"fallback"`, or `null`).
: *other* (any) : the original message is preserved.

### Details
Manages a priority array with 16 slots (`priority1` to `priority16`), `default`, and `fallback`. 

Forwards the original message from the highest non-null slot (`priority1` highest, `fallback` lowest), adding `msg.diagnostics.activePriority`. 

If no slots are set, outputs `{ payload null, diagnostics { activePriority null } }`. 
Set slots via `msg.context` with `msg.payload` (number, boolean, null) or clear via `msg.payload.clear` or `msg.payload = "clear"`.

### Status
- Green (dot): Configuration
- Blue (dot): Output, no alarm
- Red (dot): Output with alarm
- Red (ring): Errors
- Yellow (ring): Unknown context

### References
- [Node-RED Documentation](https://nodered.org/docs/)
- [GitHub Repository](https://github.com/BldgBlocks/node-red-contrib-buildingblocks-control.git)
</script>