<!-- UI Template Section: Defines the edit dialog -->
<script type="text/html" data-template-name="units-block">
    <div class="form-row">
        <label for="node-input-name" title="Display name shown on the canvas"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-unit" title="Unit to append to msg.units"><i class="fa fa-tag"></i> Unit</label>
        <input type="text" id="node-input-unit">
    </div>
</script>

<!-- JavaScript Section: Registers the node and handles editor logic -->
<script type="text/javascript">
    RED.nodes.registerType("units-block", {
        category: "control",
        color: "#301934",
        defaults: {
            name: { value: "" },
            unit: { value: "°F", required: true }
        },
        inputs: 1,
        outputs: 1,
        inputLabels: ["input"],
        outputLabels: ["output with units"],
        icon: "font-awesome/fa-tag",
        paletteLabel: "units",
        label: function() {
            return this.name || `units ${this.unit}`;
        },
        oneditprepare: function() {
            // TODO: create a shared configuration file for conversion and units.
            const validUnits = [
                // Temperature
                "°C", "°F", "K", "°R",
                
                // Humidity/Pressure
                "%RH", "Pa", "kPa", "bar", "mbar", "psi", "atm", "inH₂O", "mmH₂O", "inHg",
                
                // Flow
                "CFM", "m³/h", "L/s", 
                
                // Electrical
                "V", "mV", "A", "mA", "W", "kW", "hp", "Ω",
                
                // General/Math
                "%", 
                
                // Length
                "m", "cm", "mm", "km", "ft", "in",
                
                // Mass
                "kg", "g", "lb",
                
                // Time
                "s", "min", "h",
                
                // Volume
                "L", "mL", "gal",
                
                // Other
                "lx", "cd", "B", "T"
            ];
            $("#node-input-unit").typedInput({
                default: "str",
                types: [{
                    value: "str",
                    options: [
                        { value: "°C", label: "°C (Celsius)" },
                        { value: "°F", label: "°F (Fahrenheit)" },
                        { value: "K", label: "K (Kelvin)" },
                        { value: "°R", label: "°R (Rankine)" },
                        { value: "%RH", label: "%RH (Relative Humidity)" },
                        { value: "%", label: "% (Percent)" },
                        { value: "Pa", label: "Pa (Pascal)" },
                        { value: "kPa", label: "kPa (Kilopascal)" },
                        { value: "bar", label: "bar" },
                        { value: "mbar", label: "mbar (Millibar)" },
                        { value: "psi", label: "psi" },
                        { value: "inHg", label: "inHg (Inches of Mercury)" },
                        { value: "atm", label: "atm (Atmosphere)" },
                        { value: "inH₂O", label: "inH₂O (Inches of Water)" },
                        { value: "mmH₂O", label: "mmH₂O (Millimeters of Water)" },
                        { value: "CFM", label: "CFM (Cubic Feet per Minute)" },
                        { value: "m³/h", label: "m³/h (Cubic Meters per Hour)" },
                        { value: "L/s", label: "L/s (Liters per Second)" },
                        { value: "V", label: "V (Volt)" },
                        { value: "mV", label: "mV (Millivolt)" },
                        { value: "A", label: "A (Ampere)" },
                        { value: "mA", label: "mA (Milliampere)" },
                        { value: "W", label: "W (Watt)" },
                        { value: "kW", label: "kW (Kilowatt)" },
                        { value: "hp", label: "hp (Horsepower)" },
                        { value: "Ω", label: "Ω (Ohm)" },
                        { value: "m", label: "m (Meter)" },
                        { value: "cm", label: "cm (Centimeter)" },
                        { value: "mm", label: "mm (Millimeter)" },
                        { value: "km", label: "km (Kilometer)" },
                        { value: "ft", label: "ft (Foot)" },
                        { value: "in", label: "in (Inch)" },
                        { value: "kg", label: "kg (Kilogram)" },
                        { value: "g", label: "g (Gram)" },
                        { value: "lb", label: "lb (Pound)" },
                        { value: "s", label: "s (Second)" },
                        { value: "min", label: "min (Minute)" },
                        { value: "h", label: "h (Hour)" },
                        { value: "L", label: "L (Liter)" },
                        { value: "mL", label: "mL (Milliliter)" },
                        { value: "gal", label: "gal (Gallon)" },
                        { value: "lx", label: "lx (Lux)" },
                        { value: "cd", label: "cd (Candela)" },
                        { value: "B", label: "B (Bel)" },
                        { value: "T", label: "T (Tesla)" }
                    ]
                }],
                typeField: false
            }).typedInput("value", this.unit || "°F");
        }
    });
</script>

<!-- Help Section -->
<script type="text/markdown" data-help-name="units-block">
Appends a selected unit to `msg.units` of every input message.

### Inputs
: context (string) : Configures unit (`"unit"`) if provided. Ignored otherwise.  
: payload (any) : Input payload to pass through unchanged.

### Outputs
: payload (any) : Original payload.  
: units (string) : Selected unit (e.g., °F, %RH, inH₂O).  

### Details
Appends `msg.units` with the configured unit to every input message.  
Unit can be set via editor or dynamically with `msg.context = "unit"` and a valid unit in `msg.payload`.  
Supports units like °C, °F, %RH, inH₂O, CFM for HVAC and control systems.  
Processes every input message, preserving all original properties, just adding `msg.units`.

### Status
- Green (dot): Configuration update
- Blue (dot): State changed
- Blue (ring): State unchanged
- Red (ring): Error
- Yellow (ring): Warning

### References
- [Node-RED Documentation](https://nodered.org/docs/)  
- [GitHub Repository](https://github.com/BldgBlocks/node-red-contrib-buildingblocks-control.git)
</script>